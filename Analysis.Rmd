---
title: "Predicting Housing Sale Prices in Ames, Iowa"
output:
  html_document:
    df_print: paged
---

Project Description
With 79 explanatory variables describing (almost) every aspect of residential homes in Ames, Iowa, our goal is to predict the final price of each home of the test data set using the training data set.

Datasets
80 Columns x 1460 Rows of housing sales data from years 2006 to 2010

Source: https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data

Load and print structure of pricing data
```{r}
data <- read.csv(file = 'data.csv',
                 header = TRUE, 
                 sep = ",",
                 stringsAsFactors = FALSE)
"str(data)"
```

Select non object columns (and Set NA to 0)
For purposes of this exercise use only numeric variables (treat as continuous)
```{r}
df <- data[, sapply(data, class) != "character"]
df[is.na(df)] <- 0
str(df)
```

One-way plots
Graphs target variable (SalePrice) vs each independent variable
First 9 variables excluding Id
```{r}
nplots <- seq(from=2, to=10, by=1)

par(mfrow=c(3,3))

for (i in nplots) {
  plot(df[,i], df[,38], xlab=colnames(df)[i], ylab=colnames(df)[38])
}
```

Graphs target variable (SalePrice) vs each independent variable
11-19 variables excluding Id
```{r}
nplots <- seq(from=11, to=19, by=1)

par(mfrow=c(3,3))

for (i in nplots) {
  plot(df[,i], df[,38], xlab=colnames(df)[i], ylab=colnames(df)[38])
}
```

Graphs target variable (SalePrice) vs each independent variable
19-27 variables excluding Id
```{r}
nplots <- seq(from=20, to=28, by=1)

par(mfrow=c(3,3))

for (i in nplots) {
  plot(df[,i], df[,38], xlab=colnames(df)[i], ylab=colnames(df)[38])
}
```

Graphs target variable (SalePrice) vs each independent variable
28-37 variables excluding Id
```{r}
nplots <- seq(from=29, to=37, by=1)

par(mfrow=c(3,3))

for (i in nplots) {
  plot(df[,i], df[,38], xlab=colnames(df)[i], ylab=colnames(df)[38])
}
```

Initial Modeling and Variable Selection

```{r}
i = 2
frm <- as.formula(paste("SalePrice ~ 0 + ", colnames(data)[i]))
fit <- glm(formula = frm, data=df, family = gaussian())
summary(fit)
```

Ordinary least squares - Single variable
```{r}
nums <- seq(from=1, to=37, by=1)
fields <- character()
dev <- double()

for (i in nums) {
  f <- colnames(df)[i]
  fields[i] <- f
  frm <- as.formula(paste("SalePrice ~ 0 + ", f))
  fit <- glm(formula = frm, data=df, family = gaussian())
  dev[i] <- summary(fit)$deviance
}

devs <- data.frame(fields= fields, dev = dev)
devs <- devs[order(devs$dev),]
devs[1:15,]
```

Selected independent variables
```{r}
cols <- c(
 'LotArea',
 'OverallQual',
 'OverallCond',
 'YearBuilt',
 'TotalBsmtSF',
 'X1stFlrSF',
 'GrLivArea',
 'FullBath',
 'GarageCars',
 'WoodDeckSF'
)

X <- data[,cols]

for (f in colnames(X)) {
 X[f] = (X[f] - min(X[f])) / (max(X[f]) - min(X[f]))
}

str(X)
```

Calculate correlation between fields
```{r}
corr = cor(X)
round(corr,3)
```

Fit model to selected data
```{r}
X["SalePrice"] = data["SalePrice"]

fit <- glm(formula = "SalePrice ~ .", data=X, family = gaussian())
summary(fit)
```
Selected independent variables
```{r}
cols <- c(
 'LotArea',
 'OverallQual',
 'OverallCond',
 'YearBuilt',
 'TotalBsmtSF',
 
 'GrLivArea',
 
 'GarageCars',
 'WoodDeckSF'
)

X <- data[,cols]

for (f in colnames(X)) {
 X[f] = (X[f] - min(X[f])) / (max(X[f]) - min(X[f]))
}

str(X)
```

Calculate correlation between fields
```{r}
corr = cor(X)
round(corr,3)
```

```{r}
X["SalePrice"] = data["SalePrice"]

fit <- glm(formula = "SalePrice ~ .", data=X, family = gaussian())
summary(fit)
```
Histogram of Sale Price
```{r}
hist(data$SalePrice, breaks=30)
```


```{r}
set.seed(11)   
sample <- sample.int(n = nrow(X), size = floor(0.7*nrow(X)), replace = F)
train <- X[sample, ]
test  <- X[-sample, ]
str(train)
```

```{r}
fit <- glm(formula = "SalePrice ~ .", data=train, family = gaussian(link="log"))
summary(fit)
```

```{r}
pred_train <- predict(fit, train, type = "response")

par(mfrow=c(1,2))
plot(pred_train, as.numeric(train$SalePrice))
abline(a=0,b=1,col="red")
plot(sort(pred_train), sort(as.numeric(train$SalePrice)))
abline(a=0,b=1,col="red")
```


````{r}
pred_test <- predict(fit, test, type = "response")

par(mfrow=c(1,2))
plot(pred_test, test$SalePrice)
abline(a=0,b=1,col="red")
plot(sort(pred_test), sort(as.numeric(test$SalePrice)))
abline(a=0,b=1,col="red")
```


```{r}
mean((pred_train - as.numeric(train$SalePrice))^2) ^ 0.5
mean((pred_test - as.numeric(test$SalePrice))^2) ^ 0.5
```

